<html>

<head>
  <meta charset="utf-8">
  <title>CryptoGenLab</title>
  <meta name="description" content="Web-XR-Gallery">

  <!-- <script src="super/build.js"></script> -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.slim.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>

</head>

<body>
  <a-scene>
    <a-assets>

      <!-- <img id="sky" src="../Assets/sky.png" crossorigin="anonymous" /> -->
      <img id="grid" src="https://img.gs/bbdkhfbzkk/stretch/https://i.imgur.com/25P1geh.png" crossorigin="anonymous">
      <!-- <a-asset-item id="01" src="assets/Minimal_Default.gltf"></a-asset-item> -->
      <a-asset-item id="01" src="../Assets/Room/StaticMesh.gltf"></a-asset-item>
      <a-asset-item id="02" src="../Assets/Container02/Container02.gltf"></a-asset-item>
      <a-asset-item id="03" src="../Assets/Container03/Container03.gltf"></a-asset-item>
      <a-asset-item id="04" src="../Assets/Monitor/Monitor.gltf"></a-asset-item>
      <a-asset-item id="05" src="../Assets/Wall/Wall.gltf"></a-asset-item>
      <a-asset-item id="06" src="../Assets/Balance/Balance.gltf"></a-asset-item>
      <a-asset-item id="07" src="../Assets/Monitor01/Monitor01.gltf"></a-asset-item>
      <a-asset-item id="08" src="../Assets/Device/Device.gltf"></a-asset-item>
      <a-asset-item id="09" src="../Assets/Monitor02/Monitor02.gltf"></a-asset-item>
      <a-asset-item id="10" src="../Assets/Tube/Tube.gltf"></a-asset-item>
      
      <a-cubemap id="sky">
        <img src="../Assets/CubeMap/right.png">
        <img src="../Assets/CubeMap/left.png">
        <img src="../Assets/CubeMap/top.png">
        <img src="../Assets/CubeMap/bottom.png">
        <img src="../Assets/CubeMap/front.png">
        <img src="../Assets/CubeMap/back.png">
      </a-cubemap>



    </a-assets>
    
    <!-- <a-entity position="0 0 0" geometry="primitive: plane; width: 10000; height: 10000;" rotation="-90 0 0"
    material="src: #grid; repeat: 10000 10000; transparent: true; metalness:0.6; roughness: 0.4; sphericalEnvMap: #sky;">
  </a-entity> -->
  
  
  <!-- <a-entity position="0 1 0" geometry="primitive: plane; width: 50; height: 50;" rotation="-90 0 0"
  material="src: #grid; repeat: 50 50; transparent: true; metalness:0.6; roughness: 0.4; sphericalEnvMap: #sky;">
</a-entity> -->

  
  <a-entity geometry="primitive: box" material="envMap: #sky; roughness: 0"></a-entity>

    
    <a-entity id="rig" movement-controls position="0 1 0.6">
      <a-entity id="player" camera="fov:80" look-controls wasd-controls="acceleration:50" position="0 3.05 0.6">

      </a-entity>
      <a-entity hand-controls="hand:left"></a-entity>
      <a-entity hand-controls="hand:right"></a-entity>
    </a-entity>

    <a-entity id="model01" gltf-model="#01" position="0 0.9 0"></a-entity>
    <!-- <a-entity id="model02" gltf-model="#02" position="0.5 0.9 0"></a-entity>
    <a-entity id="model03" gltf-model="#03" position="1 0.9 0"></a-entity>
    <a-entity id="model04" gltf-model="#04" position="1.5 0.9 0"></a-entity>
    <a-entity id="model05" gltf-model="#05" position="2 0.9 0"></a-entity>
    <a-entity id="model06" rotation="0 90 0" gltf-model="#06" position="-5.29673 2.34194 0.58127"></a-entity>
    <a-entity id="model07" rotation="0 -90 0" gltf-model="#07" position="-5.90105 3.00126 2.66504"></a-entity>
    <a-entity id="model08" rotation="0 90 0" gltf-model="#08" position="-7.64113 1.1 6.34224"></a-entity>
    <a-entity id="model09" rotation="0 -90 0" gltf-model="#09" position="-5.00163 1.1 0.73473"></a-entity>
    <a-entity id="model10" rotation="0 90 0" gltf-model="#10" position="-5.27919 2.3397 0.03302"></a-entity> -->

    <!--<a-sphere
            id="sphere"
            position="0 3 -5"
            radius="2"
      color="blue"></a-sphere>-->

    <a-entity id="ambientLight" light="type: ambient; color: #ccc; intensity: 0"></a-entity>
    <a-entity id="keyLight" light="type: directional; color: #ccc; intensity: 1" position="10 10 10">
    </a-entity>
    <a-entity id="fillLight" light="type: directional; color: #90e0ef; intensity: 0.2" position="0.363 0.036 -0.004">
    </a-entity>

    <a-sphere id="sphere" color="blue" position="0 6 2"></a-sphere>
    <a-sphere color="blue" position="0 6 -2"></a-sphere>

    <!-- <a-entity light="color: #ffaaff; intensity: 1.5" position="5 5 5"></a-entity> -->
    <!--<a-sky src="#sky"></a-sky>-->

  </a-scene>

  <script type="module">
    import { EffectComposer } from "https://cdn.jsdelivr.net/npm/three@0.125.1/examples/jsm/postprocessing/EffectComposer.js"
    import { RenderPass } from "https://cdn.jsdelivr.net/npm/three@0.125.1/examples/jsm/postprocessing/RenderPass.js";
    import { UnrealBloomPass } from "https://cdn.jsdelivr.net/npm/three@0.125.1/examples/jsm/postprocessing/UnrealBloomPass.js";
    import { LightProbeGenerator } from "https://cdn.jsdelivr.net/npm/three@0.125.1/examples/jsm/lights/LightProbeGenerator.js";

    const sceneEl = document.querySelector('a-scene');
    const renderer = sceneEl.renderer;
    let lightProbe;

    renderer.toneMappingExposure = 0.5;

    lightProbe = new THREE.LightProbe();

    sceneEl.object3D.add(lightProbe);

    new THREE.CubeTextureLoader()
            .setPath( '../Assets/CubeMap/' )
            .load( [
              'Right.png',
              'Left.png',
              'Top.png',
              'Bottom.png',
              'Front.png',
              'Back.png'
            ], function (cubeTexture) {
              cubeTexture.encoding = THREE.sRGBEncoding;
              cubeTexture.mapping = THREE.CubeRefractionMapping;
              sceneEl.object3D.background = cubeTexture;
              lightProbe.copy( LightProbeGenerator.fromCubeTexture(cubeTexture) );

              const canvas = document.createElement( 'canvas' );
              canvas.width = 2;
              canvas.height = 2;

              const context = canvas.getContext( '2d' );
              context.fillStyle = 'white';
              context.fillRect( 0, 1, 2, 1 );

              const texture = new THREE.CanvasTexture( canvas );

              const sphere = document.getElementById("sphere").object3D;
              sphere.el.object3DMap['mesh'].material = new THREE.MeshPhysicalMaterial( {
                color: 0xfffff,
                metalness: 0,
                roughness: 0,
                ior: 2,
                envMap: cubeTexture,
                envMapIntensity: 1,
                transmission: 1, // use material.transmission for glass materials
                specularIntensity: 1,
                specularColor: 0xfffff,
                opacity: 1,
                side: THREE.DoubleSide,
                transparent: true
              } );
            } );

    AFRAME.registerSystem('effects', {
      /**
       * Configure composer with a few arbitrary passes.
       */
      init: function () {
        const sceneEl = this.sceneEl;

        if (!sceneEl.hasLoaded) {
          sceneEl.addEventListener('render-target-loaded', this.init.bind(this));
          return;
        }

        const scene = sceneEl.object3D;
        const renderer = sceneEl.renderer;
        const camera = sceneEl.camera;

        renderer.toneMapping = THREE.NoToneMapping;

        renderer.outputEncoding = THREE.sRGBEncoding;

        const composer = new EffectComposer(renderer);
        const pass1 = new RenderPass(scene, camera);
        const pass2 = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);

        pass2.threshold = 0.1;
        pass2.exposure = 0.5;
        pass2.strength = 0.5;
        pass2.radius = 0.5;


        composer.addPass(pass1);
        composer.addPass(pass2);

        this.composer = composer;
        this.t = 0;
        this.dt = 0;

        this.bind();
      },

      /**
       * Record the timestamp for the current frame.
       * @param {number} t
       * @param {number} dt
       */
      tick: function (t, dt) {
        this.t = t;
        this.dt = dt;
      },

      /**
       * Binds the EffectComposer to the A-Frame render loop.
       * (This is the hacky bit.)
       */
      bind: function () {
        const renderer = this.sceneEl.renderer;
        const render = renderer.render;
        const system = this;
        let isDigest = false;

        renderer.render = function () {
          if (isDigest) {
            render.apply(this, arguments);
          } else {
            isDigest = true;
            system.composer.render(system.dt);
            isDigest = false;
          }
        };
      }
    });
  </script>

</body>

</html>
<html>

<head>
  <meta charset="utf-8">
  <title>CryptoGenLab_Lobby</title>
  <meta name="description" content="Web-XR-Gallery">

  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.slim.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  <script src="/js/cube-map.component.js"></script>
  <script src="../js/obj-lerp.component.js"></script>
  <script src="../js/lerp.js"></script>
  <script src="../js/nav-mesh.component.js"></script>
  <script src="../js/vertical-movement.component.js"></script>



  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/Pass.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.125.1/examples/js/shaders/CopyShader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.125.1/examples/js/postprocessing/ShaderPass.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.125.1/examples/js/postprocessing/EffectComposer.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.125.1/examples/js/postprocessing/RenderPass.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.125.1/examples/js/shaders/LuminosityHighPassShader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.125.1/examples/js/shaders/FXAAShader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.125.1/examples/js/postprocessing/UnrealBloomPass.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.125.1/examples/js/lights/LightProbeGenerator.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.125.1/examples/js/libs/dat.gui.min.js"></script>
  <script src="https://unpkg.com/aframe-cubemap-component@2.1.1/dist/aframe-cubemap-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.125.1/examples/js/renderers/CSS3DRenderer.js"></script>
  <script
    src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script>
  <script src="https://recast-api.donmccurdy.com/aframe-inspector-plugin-recast.js"></script>


</head>

<body>
  <div id="container"></div>

  <a-scene physics="debug:true" inspector-plugin-recast set-video renderer="antialias: true;
                    colorManagement: true;
                    sortObjects: false;">
    <a-assets>
      <!-- <a-asset-item id="01" src="../Assets/lab2/RoomBaking/Room_Baking.gltf"></a-asset-item> -->
      <!-- <a-asset-item id="01" src="../Assets/lab4/RoomBaking/Room_Baking.gltf"></a-asset-item> -->
      <a-asset-item id="01" src="../Assets/Lobby/Lobby.gltf"></a-asset-item>
      <a-asset-item id="02" src="../Assets/Monitors/Monitors.gltf"></a-asset-item>
      <a-asset-item id="03" src="../Assets/Furniture/Furniture.gltf"></a-asset-item>
      <a-asset-item id="04" src="../Assets/Sofa/Sofa.gltf"></a-asset-item>
      <a-asset-item id="05" src="../Assets/Lobby/SM_LabDoor03.gltf"></a-asset-item>
      <a-asset-item id="06" src="../Assets/Panel_Log/Panel_Log.gltf"></a-asset-item>
      <a-asset-item id="07" src="../Assets/L_Assets_01/L_Assets_01.gltf"></a-asset-item>
      <a-asset-item id="08" src="../Assets/Hologram/CG_Logo_3D_Icon.gltf"></a-asset-item>
      <a-asset-item id="09" src="../Assets/Hologram/SM_Lamp_A.gltf"></a-asset-item>
      <a-asset-item id="10" src="../Assets/Device_01/SM_ScientificDevice01.gltf"></a-asset-item>
      <a-asset-item id="11" src="../Assets/Lamp/SM_Lamp01.gltf"></a-asset-item>
      <a-asset-item id="12" src="../Assets/Lobby/Elevator.gltf"></a-asset-item>
      <a-asset-item id="13" src="../Assets/Lobby/NuclearRoom.gltf"></a-asset-item>
      <a-asset-item id="15" src="../Assets/NuclearReactor/NuclearReactor_2.gltf"></a-asset-item>
      <a-asset-item id="16" src="../Assets/Lobby/NuclearReactor_Base.gltf"></a-asset-item>
      <!-- <video id="videoTst" autoplay loop="true" src="1.mp4"></video> -->
      <a-asset-item id="nav-Mesh-GLTF" src="../Assets/tst/nav-mesh-loby.glb"></a-asset-item>
      <!--<video id="video01" autoplay loop="true" src="https://www.youtube.com/watch?v=OdfPxhtKszw&ab_channel=Sortium"></video>-->

      <!-- <img id="sky" src="../Assets/sky.png" crossorigin="anonymous" /> -->
      <!-- <img id="grid" src="https://img.gs/bbdkhfbzkk/stretch/https://i.imgur.com/25P1geh.png" crossorigin="anonymous"> -->
      <!-- <a-asset-item id="01" src="assets/Minimal_Default.gltf"></a-asset-item> -->
      <!-- <a-asset-item id="01" src="../Assets/Room/StaticMesh.gltf"></a-asset-item> -->

      <!-- <a-asset-item id="Player_Character" src="../Assets/Character/ScientistMale_GLTF_NoTextures_NoSK2.gltf"></a-asset-item> -->


      <!-- <a-asset-item id="Incubator" src="../Assets/Incubator2/Incubator1.gltf"></a-asset-item>
        <a-asset-item id="IncubatorHelix" src="../Assets/Incubator2/IncubatorHelix.gltf"></a-asset-item> -->




    </a-assets>
    <!-- <a-entity gltf-model="#Player_Character" position="-0.420 2.5 8.510"></a-entity> -->


    <!-- <a-entity id="e-Incubator" rotation="0 90 0" gltf-model="#Incubator" position="0 2.5 -8.140"></a-entity>
    <a-entity id="e-IncubatorHelix" rotation="0 90 0" gltf-model="#IncubatorHelix" position="0 2.5 -8.140"></a-entity> -->


    <!-- <a-entity position="0 0 0" geometry="primitive: plane; width: 10000; height: 10000;" rotation="-90 0 0"
    material="src: #grid; repeat: 10000 10000; transparent: true; metalness:0.6; roughness: 0.4; sphericalEnvMap: #sky;">
  </a-entity> -->


    <!-- <a-entity position="0 1 0" geometry="primitive: plane; width: 50; height: 50;" rotation="-90 0 0"
    material="src: #grid; repeat: 50 50; transparent: true; metalness:0.6; roughness: 0.4; sphericalEnvMap: #sky;">
  </a-entity> -->


    <!-- <a-entity id="cubeMap" geometry="primitive: box; width:100; height:100; depth:100; side:double" material="envMap: #sky; roughness: 0"></a-entity> -->

    <!-- <a-entity cubemap="folder: ../Assets/CubeMap2/"></a-entity> -->



    <a-entity id="rig" tst position="-1.3 2.75 18.6" position="0 0 0"  rotation="0 180 0" movement-controls="constrainToNavMesh: true; speed:0.8">
      <a-entity id="player" camera="fov:90" look-controls vertical-movement="speed:1" position="0 2 -2" rotation="0 0 0"></a-entity>
    </a-entity>
    

  <!--  <a-entity id="labModel" position="-3 3 -0.18" rotation="0 270 0" gltf-model="#01" cube-map="path: ../Assets/Lobby_CubeMap/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="door01" position="-1.28 3.09 -1.2" rotation="0 -90 0" gltf-model="#05" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="door02" position="-1.28 3.09 -1.2" rotation="0 90 0" gltf-model="#05" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="door03" position="-1.28 3.09 19.8" rotation="0 -90 0" gltf-model="#05" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="door04" position="-1.28 3.09 19.8" rotation="0 90 0" gltf-model="#05" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">-->
    </a-entity>
    <a-entity id="door01" position="-1.28 3.09 20.140" rotation="0 -90 0" gltf-model="#05" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="door02" position="-1.28 3.09 20.140" rotation="0 90 0" gltf-model="#05" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;"> 
    </a-entity>
    <a-entity id="door03" position="-1.160 3.09 24.05" rotation="0 -90 0" gltf-model="#05" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="door04" position="-1.160 3.09 24.05" rotation="0 90 0" gltf-model="#05" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="door05" position="-1.160 -207.180 24.460" rotation="0 -90 0" gltf-model="#05" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="door06" position="-1.160 -207.180 24.460" rotation="0 90 0" gltf-model="#05" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="door07" position="-1.240 -207.230 158.530" rotation="0 -90 0" gltf-model="#05" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="door08" position="-1.240 -207.230 158.530" rotation="0 90 0" gltf-model="#05" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
   <!-- <a-entity id="Monitors" position="-1.2 3.3 -5" rotation="0 270 0" gltf-model="#02" cube-map="path: ../Assets/Lobby_CubeMap/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="Furniture" position="-1.2 3 -11" rotation="0 270 0" gltf-model="#03" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="Sofa01" position="2.5 3 -9" rotation="0 270 0" scale="1.5 1.5 1.5" gltf-model="#04" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="Sofa02" position="-5 3 -9" rotation="0 90 0" scale="1.5 1.5 1.5" gltf-model="#04" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="panel_log" position="2.2 3 -1.6" rotation="0 -90 0" gltf-model="#06" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="L_Assets_01" position="-10 3 -2.9" rotation="0 -90 0" gltf-model="#07" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="h_icon" position="-1.18 4.45 -9.1" rotation="90 0 0" scale="1.5 1.5 1.5" gltf-model="#08" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="h_base" position="-1.18 3.4 -9.1" rotation="0 0 0" scale="3 2.5 3" gltf-model="#09" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="device_01" position="-4.82 3.05 -2.06" rotation="0 180 0" scale="0.58 0.58 0.58" gltf-model="#10"
      cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="Lamp_01" position="-3.35 6.850 -4.24" rotation="0 180 0" scale="0.58 0.58 0.58" gltf-model="#11"
      cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="Lamp_02" position="0.650 6.850 -4.24" rotation="0 180 0" scale="0.58 0.58 0.58" gltf-model="#11"
      cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;"> -->
    </a-entity>
    <a-entity id="Elevator" position="-1.200 3 22.1" rotation="0 -90 0" gltf-model="#12" cube-map="path: ../Assets/CubeMap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="N_Room" position="-1.31 -337.47 69.89" rotation="0 270 0" gltf-model="#13" cube-map="path: ../Assets/Cubemap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="N_Reactor" position="-1.370 -208.840 88.860" rotation="0 270 0" scale="2 2 2" gltf-model="#15" cube-map="path: ../Assets/Cubemap3/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>
    <a-entity id="Base" position="-1.370 -208.840 88.860" rotation="0 270 0" scale="40 0.2 40" gltf-model="#16" cube-map="path: ../Assets/Lobby_CubeMap/;
                  extension: jpg;
                  reflectivity: 1;">
    </a-entity>

    </a-entity>

    <a-entity visible="false" id="fillLight"
      light="type: directional; color: #90e0ef; intensity: 0.0; castShadow: false; penumbra: 0; angle: 62.15; decay: 1; distance: 0"
      position="0.363 0.036 -0.004">
    </a-entity>


  </a-scene>

  <script>



    AFRAME.registerComponent('tst', {
      schema: {
        speed: { default: 0.1 },
        offset: { default: 1 },
      },

      init: function () {

        var playerEl = document.getElementById("rig")
        playerEl.addEventListener('collide', function (e) {
          console.log('Player has collided with body #' + e.detail.body.id);

          e.detail.target.el;  // Original entity (playerEl).
          e.detail.body.el;    // Other entity, which playerEl touched.
          e.detail.contact;    // Stats about the collision (CANNON.ContactEquation).
          e.detail.contact.ni; // Normal (direction) of the collision (CANNON.Vec3).
        });

      },






    });



  </script>
  <script>
    AFRAME.registerComponent('set-renderer', {

      init: function () {
        this.el.renderer.physicallyCorrectLights = false;
        this.el.renderer.toneMapping = THREE.ACESFilmicToneMapping;
        this.el.renderer.colorManagement = true;
      }
    })
  </script>

  <script type="module">

    AFRAME.registerSystem('effects', {
      /**
       * Configure composer with a few arbitrary passes.
       */
      init: function () {
        const sceneEl = this.sceneEl;
        const scene = sceneEl.object3D;
        const renderer = sceneEl.renderer;
        const camera = sceneEl.camera;

        renderer.autoClear = false;
        //renderer.setPixelRatio( window.devicePixelRatio );
        renderer.antialias = true;
        renderer.alpha = true;

        if (!sceneEl.hasLoaded) {
          sceneEl.addEventListener('loaded', this.init.bind(this));
          return;
        }


        renderer.toneMapping = THREE.NoToneMapping;
        renderer.outputEncoding = THREE.sRGBEncoding;

        this.lightProbe = new THREE.LightProbe();
        this.lightProbe.intensity = 0;

        scene.add(this.lightProbe);
        const systemLightProbe = this.lightProbe;

        const composer = new THREE.EffectComposer(renderer);
        composer.setSize(window.innerWidth, window.innerHeight);
        const pass1 = new THREE.RenderPass(scene, camera);
        const pass2 = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        const fxaaPass = new THREE.ShaderPass(THREE.FXAAShader);

        pass2.threshold = 0.75;
        // pass2.exposure = 0.8;
        pass2.strength = 0.6;
        pass2.radius = 0.64;

        const gui = new dat.GUI()
        gui.add(pass2, "threshold", 0, 2)
        // gui.add( pass2, "exposure", 0, 1)
        gui.add(pass2, "strength", 0, 2)
        gui.add(pass2, "radius", 0, 2)


        // pass2.threshold = 0.15;
        // pass2.exposure = 0.8;
        // pass2.strength = 0.6;
        // pass2.radius = 0.5;


        composer.addPass(pass1);
        composer.addPass(pass2);
        composer.addPass(fxaaPass);

        new THREE.CubeTextureLoader()
          .setPath('../Assets/CubeMap2/')
          .load([
            'posx.jpg',
            'negx.jpg',
            'posy.jpg',
            'negy.jpg',
            'posz.jpg',
            'negz.jpg'
          ], function (cubeTexture) {
            systemLightProbe.copy(THREE.LightProbeGenerator.fromCubeTexture(cubeTexture));
            systemLightProbe.intensity = 0.65
          });

        this.lightProbe = systemLightProbe;

        gui.add(this.lightProbe, "intensity", 0, 10)

        this.lightProbe.intensity = 0.65
        this.composer = composer;
        this.t = 0;
        this.dt = 0;

        this.bind();
      },

      /**
       * Record the timestamp for the current frame.
       * @param {number} t
       * @param {number} dt
       */
      tick: function (t, dt) {
        this.t = t;
        this.dt = dt;
      },

      /**
       * Binds the EffectComposer to the A-Frame render loop.
       * (This is the hacky bit.)
       */
      bind: function () {
        const renderer = this.sceneEl.renderer;
        const render = renderer.render;
        const system = this;
        let isDigest = false;

        renderer.render = function () {
          if (isDigest) {
            render.apply(this, arguments)
          } else {
            isDigest = true;
            system.composer.render(system.dt);
            isDigest = false;
          }
        };
      }
    });
  </script>



</body>

</html>